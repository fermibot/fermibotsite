<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Timeline - Biryani Preparation</title>
  <script src="https://unpkg.com/timelines-chart@2/dist/timelines-chart.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f8f8;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #d35400;
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #f39c12;
      padding-bottom: 10px;
    }
    .description {
      text-align: center;
      margin-bottom: 20px;
      color: #666;
    }
    #timeline {
      width: 100%;
      height: 600px;
      margin-bottom: 20px;
    }
    .legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin: 5px 15px;
    }
    .legend-color {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      border-radius: 4px;
    }
    .instructions {
      margin-top: 30px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 5px;
      border-left: 4px solid #f39c12;
    }
    .instructions h3 {
      margin-top: 0;
      color: #d35400;
    }
    .recipe-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .recipe-section {
      flex: 1;
      min-width: 200px;
      margin: 10px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 5px;
    }
    .recipe-section h3 {
      color: #d35400;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    ul {
      padding-left: 20px;
    }
    li {
      margin-bottom: 5px;
    }
    @media (max-width: 768px) {
      .recipe-info {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Biryani Recipe Timeline</h1>

  <div class="description">
    <p>This interactive timeline visualizes the step-by-step process of making biryani, showing how different preparation stages overlap and sequence.</p>
  </div>

  <div class="recipe-info">
    <div class="recipe-section">
      <h3>For Rice</h3>
      <ul>
        <li>Water as required</li>
        <li>Salt to taste</li>
        <li>1 tsp Ghee</li>
        <li>½ inch Cinnamon stick</li>
        <li>1 Bay leaf</li>
        <li>3 cups Sella basmati rice (soaked for 20 minutes)</li>
      </ul>
    </div>

    <div class="recipe-section">
      <h3>For Jhol</h3>
      <ul>
        <li>⅓ cup Milk</li>
        <li>1 ½ tsp Saffron water</li>
        <li>¼ tsp Green cardamom & mace powder</li>
        <li>A pinch of shahi jeera (optional)</li>
        <li>1 Green chilli, less spicy & slit</li>
        <li>Few Mint leaves, roughly torn</li>
        <li>2 tbsp Coriander leaves, roughly torn</li>
        <li>Salt to taste</li>
        <li>½ tsp Sugar</li>
      </ul>
    </div>

    <div class="recipe-section">
      <h3>For Layering</h3>
      <ul>
        <li>Marinated Chicken</li>
        <li>1st batch of Cooked Rice</li>
        <li>Prepared Jhol</li>
        <li>Saffron water</li>
        <li>Fried Onions</li>
        <li>2nd batch of Cooked rice</li>
        <li>1 tsp Ghee</li>
      </ul>
    </div>
  </div>

  <div id="timeline"></div>

  <div class="legend" id="legend"></div>

  <div class="instructions">
    <h3>How to Read the Timeline</h3>
    <p>Each horizontal bar represents a cooking task. The position and length of the bar shows when the task starts and how long it takes. Tasks that overlap can be done simultaneously. Hover over any bar to see details about that step.</p>
  </div>
</div>

<script>
  // Create timeline data based on the recipe
  function createRecipeTimelineData() {
    // Base time - we'll use today at 10:00 AM as our starting point
    const baseTime = new Date();
    baseTime.setHours(10, 0, 0, 0);

    // Define the recipe steps with start and end times (in minutes from baseTime)
    const steps = [
      // Preparation group
      { group: "Preparation", label: "Fry Onions", start: 0, end: 10, category: "prep" },
      { group: "Preparation", label: "Marinate Chicken", start: 10, end: 15, category: "prep" },

      // Rice Cooking group
      { group: "Rice Cooking", label: "Cook Rice (Batch 1 & 2)", start: 15, end: 20, category: "rice" },
      { group: "Rice Cooking", label: "Rest Rice (Both Batches)", start: 20, end: 40, category: "rest" },

      // Jhol Preparation group
      { group: "Jhol Preparation", label: "Prepare Saffron Jhol", start: 25, end: 30, category: "jhol" },

      // Layering group
      { group: "Layering", label: "Layer Ingredients", start: 40, end: 45, category: "layer" },

      // Cooking group
      { group: "Cooking", label: "Dum Cooking (High Flame)", start: 45, end: 47, category: "cook" },
      { group: "Cooking", label: "Dum Cooking (Low Flame)", start: 47, end: 67, category: "cook" },

      // Final group
      { group: "Final", label: "Rest Dish", start: 67, end: 79, category: "rest" },
      { group: "Final", label: "Garnish and Serve", start: 79, end: 80, category: "final" }
    ];

    // Convert to the format required by timelines-chart
    const groups = {};

    steps.forEach(step => {
      if (!groups[step.group]) {
        groups[step.group] = {
          group: step.group,
          data: []
        };
      }

      // Find or create the label within the group
      let labelData = groups[step.group].data.find(item => item.label === step.label);
      if (!labelData) {
        labelData = {
          label: step.label,
          data: []
        };
        groups[step.group].data.push(labelData);
      }

      // Calculate start and end times
      const startTime = new Date(baseTime.getTime() + step.start * 60000);
      const endTime = new Date(baseTime.getTime() + step.end * 60000);

      // Add the time segment
      labelData.data.push({
        timeRange: [startTime, endTime],
        val: step.category
      });
    });

    return Object.values(groups);
  }

  // Create the chart
  function createTimelineChart() {
    const data = createRecipeTimelineData();

    // Create the timeline chart
    const chart = TimelinesChart(); // Initialize the chart

    // Set the data and various options
    chart.data(data)
            .zQualitative(true)
            .zColorScale(d3.scaleOrdinal()
                    .domain(["prep", "rice", "rest", "jhol", "layer", "cook", "final"])
                    .range(["#e74c3c", "#3498db", "#2ecc71", "#9b59b6", "#f1c40f", "#e67e22", "#1abc9c"]));

    // CORRECTED: Set the margin as a property
    // chart.margin({ top: 30, right: 30, bottom: 50, left: 200 });

    // Finally, render the chart
    const chartElement = document.getElementById('timeline');
    chart(chartElement);

    createLegend(); // Create your legend
    return chart;
  }

  // Create a legend for the chart
  function createLegend() {
    const legendData = [
      { category: "prep", label: "Preparation" },
      { category: "rice", label: "Rice Cooking" },
      { category: "rest", label: "Resting" },
      { category: "jhol", label: "Jhol Preparation" },
      { category: "layer", label: "Layering" },
      { category: "cook", label: "Cooking" },
      { category: "final", label: "Final Steps" }
    ];

    const colorScale = d3.scaleOrdinal()
            .domain(["prep", "rice", "rest", "jhol", "layer", "cook", "final"])
            .range(["#e74c3c", "#3498db", "#2ecc71", "#9b59b6", "#f1c40f", "#e67e22", "#1abc9c"]);

    const legendContainer = d3.select("#legend");

    legendData.forEach(item => {
      const legendItem = legendContainer.append("div")
              .attr("class", "legend-item");

      legendItem.append("div")
              .attr("class", "legend-color")
              .style("background-color", colorScale(item.category));

      legendItem.append("span")
              .text(item.label);
    });
  }

  // Initialize the chart when the page loads
  document.addEventListener('DOMContentLoaded', function() {
    createTimelineChart();
  });
</script>
</body>
</html>