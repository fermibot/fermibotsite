<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wellness | Breathing | Coherent Breathing - A Guide for All Levels</title>


    <link rel="stylesheet" href="../../../d3_templates/hierarchical_dendrogram.css">
    <link rel="stylesheet" href="../../../index.css">
    <link rel="stylesheet" href="../../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../js/highlight/styles/default.css">
    <link rel="stylesheet" href="../../../external_libraries/bootstrap/bootstrap.min.css">

    <!-- Main CSS for this page -->
    <link rel="stylesheet" href="coherent_breathing.css">

    <script src="../../../d3/d3.v4.min.js"></script>
    <script src="../../../automation/loadObjects.js"></script>
    <script src="../../../js/highlight/highlight.pack.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

<div id="header_placeholder"></div>

<div class="container-lg coherent-breathing-page">
    <h1 class="page-title">Wellness | Breathing | Coherent Breathing</h1>

    <p class="page-intro">
        A guided experience for everyone - from absolute beginners to breathing experts.<br>
        Choose your level to get started:
    </p>

    <!-- Level Navigation -->
    <div class="row mb-5">
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100 level-card" id="beginnerCard"
                 onclick="scrollToSection('beginnerSection')" style="cursor: pointer;">
                <div class="card-body">
                    <h3 class="card-title beginner-color">üå± Beginner</h3>
                    <p class="card-text">New to coherent breathing? Start here with educational videos to understand the
                        basics.</p>
                    <div class="badge beginner-badge">Start Here</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100 level-card" id="practitionerCard"
                 onclick="scrollToSection('practitionerSection')" style="cursor: pointer;">
                <div class="card-body">
                    <h3 class="card-title practitioner-color">üîÑ Practitioner</h3>
                    <p class="card-text">Familiar with the basics? Choose from established breathing patterns for
                        practice.</p>
                    <div class="badge practitioner-badge">Practice Patterns</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100 level-card" id="expertCard" onclick="scrollToSection('expertSection')"
                 style="cursor: pointer;">
                <div class="card-body">
                    <h3 class="card-title expert-color">üéõÔ∏è Expert</h3>
                    <p class="card-text">Ready for advanced practice? Create custom breathing patterns tailored to your
                        needs.</p>
                    <div class="badge expert-badge">Custom Creator</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 1: Beginner -->
    <div id="beginnerSection" class="level-section">
        <div class="section-header beginner-header">
            <h2 class="section-title beginner-color center-flex">üå± Beginner Level | Learn the Basics</h2>
            <p class="section-description">Start your coherent breathing journey with these educational
                videos. Learn what coherent breathing is, why it works, and how to get started.</p>
        </div>

        <div class="row mt-4">
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title beginner-color text-center">üé• What is Coherent Breathing?</h5>
                        <p class="card-text">Learn the fundamentals of coherent breathing and how it benefits your
                            nervous system.</p>
                        <div class="video-container">
                            <iframe
                                    class="w-100"
                                    height="315"
                                    src="https://www.youtube.com/embed/q06YIWCR2Js"
                                    title="What is Coherent Breathing?"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                    referrerpolicy="strict-origin-when-cross-origin"
                                    allowfullscreen>
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title beginner-color text-center cent">üéì The Science Behind It</h5>
                        <p class="card-text">Understand the science of heart rate variability and why 5.5-5.5 breathing
                            is optimal.</p>
                        <div class="video-container">
                            <iframe
                                    class="w-100"
                                    height="315"
                                    src="https://www.youtube.com/embed/Q_fFattg8N0?pp=ygUnYmVpbmcgYnJpbGxpYW50IGV2ZXJ5IHNpbmdsZSBkYXkgcGFydCAy2AYD"
                                    title="Science of Coherent Breathing"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                    referrerpolicy="strict-origin-when-cross-origin"
                                    allowfullscreen>
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4 tips-card">
            <div class="card-body">
                <div class="tips-header-row">
                    <h5 class="card-title beginner-color collapsible-header collapsed"
                        onclick="toggleCollapse('beginnerChecklist', this)">
                        üìù Beginner's Checklist
                        <span class="collapse-icon">‚ñ∂</span>
                    </h5>
                    <div class="tips-navigation-inline">
                        <button class="btn beginner-btn btn-sm" onclick="scrollToSection('practitionerSection')">
                            ü°á Practitioner Level
                        </button>
                    </div>
                </div>
                <div class="collapsible-content collapsed" id="beginnerChecklist">
                    <ul>
                        <li>‚úÖ Watch both videos to understand the concept</li>
                        <li>‚úÖ Find a comfortable, quiet place to practice</li>
                        <li>‚úÖ Start with just 5 minutes per day</li>
                        <li>‚úÖ Focus on consistency rather than duration</li>
                        <li>‚úÖ Move to Practitioner level when ready to try patterns</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 2: Practitioner -->
    <div id="practitionerSection" class="level-section">
        <div class="section-header practitioner-header">
            <h2 class="section-title practitioner-color center-flex">üîÑ Practitioner Level | Practice with Patterns</h2>
            <p class="section-description">Choose from established breathing patterns. Each pattern is designed for specific benefits.
                Start with the standard 5.5-5.5 pattern for optimal results.</p>
        </div>

        <!-- Unified Audio Controls -->
        <div class="audio-controls">
            <!-- Unified Control Panel -->
            <div class="row">
                <div class="unified-control-panel mb-4 col-12">
                    <div class="control-panel-inner">
                        <!-- Timer Mode Toggle and Session Timer -->
                        <div class="timer-section">
                            <!-- Timer with integrated mode toggle -->
                            <div class="session-timer-inline">
                                <div class="timer-mode-toggle" title="Switch between timed (countdown) and infinite (count up) modes">
                                    <button class="timer-mode-btn active" id="timedModeBtn" onclick="setTimerMode('timed')" title="Timed mode: Set a duration and timer counts down">
                                        ‚è±Ô∏è Timed
                                    </button>
                                    <button class="timer-mode-btn" id="infiniteModeBtn" onclick="setTimerMode('infinite')" title="Infinite mode: Timer counts up indefinitely">
                                        ‚àû Infinite
                                    </button>
                                </div>
                                <input type="text"
                                       class="session-timer editable"
                                       id="sessionTimer"
                                       value="00:05:00"
                                       title="Session Timer - Click to edit duration (HH:MM:SS)"
                                       pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}"
                                       maxlength="8"
                                       onchange="onTimerInputChange(this.value)"
                                       onkeydown="onTimerKeyDown(event, this)">
                            </div>
                        </div>

                        <!-- Play/Pause/Stop Buttons -->
                        <div class="unified-buttons">
                            <button class="btn btn-primary btn-lg unified-play" id="unifiedPlay" disabled>
                                ‚ñ∂Ô∏è Play
                            </button>
                            <button class="btn btn-secondary btn-lg unified-pause" id="unifiedPause" disabled>
                                ‚è∏Ô∏è Pause
                            </button>
                            <button class="btn btn-outline-secondary btn-lg unified-stop" id="unifiedStop" disabled>
                                ‚èπÔ∏è Stop
                            </button>
                        </div>

                        <!-- Status Display -->
                        <div class="unified-status">
                            <span class="loading-status" id="unifiedLoadingStatus">Loading audio files...</span>
                            <span class="selected-pattern"
                                  id="selectedPatternDisplay">Selected: 5.5-5.5 (Standard)</span>
                        </div>
                    </div>
                </div>


            </div>

            <!-- Pattern Selection Cards -->
            <h5 class="text-center mb-3 text-secondary">Select a Pattern:</h5>


            <!-- Other Patterns Grid -->
            <div class="row">

                <!-- Standard Pattern (Highlighted) -->
                <div class="col-md-6 mb-3">
                    <div>
                        <div class="pattern-selector-card selected standard-pattern-highlight"
                             data-pattern-id="55.5"
                             data-audio-url="Coherent_Piano_5.5_5.5_fermibot.mp3"
                             onclick="selectPattern(this)">
                            <div class="pattern-selector-content">
                                <div class="pattern-radio">
                                    <span class="radio-indicator"></span>
                                </div>
                                <div class="pattern-info">
                                    <h5 class="pattern-title">‚≠ê 5.5-5.5 Breathing Pattern
                                    </h5>
                                    <p class="pattern-description mb-0">5.5s inhale, 5.5s exhale | For optimal
                                        HRV <span class="badge bg-success">Standard</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <div class="pattern-selector-card"
                         data-pattern-id="55"
                         data-audio-url="Coherent_Piano_5_5_fermibot.mp3"
                         onclick="selectPattern(this)">
                        <div class="pattern-selector-content">
                            <div class="pattern-radio">
                                <span class="radio-indicator"></span>
                            </div>
                            <div class="pattern-info">
                                <h5 class="pattern-title">üåº 5-5 Breathing Pattern</h5>
                                <p class="pattern-description mb-0">5s inhale, 5s exhale | For energy and focus</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <div class="pattern-selector-card"
                         data-pattern-id="66"
                         data-audio-url="Coherent_Piano_6_6_fermibot.mp3"
                         onclick="selectPattern(this)">
                        <div class="pattern-selector-content">
                            <div class="pattern-radio">
                                <span class="radio-indicator"></span>
                            </div>
                            <div class="pattern-info">
                                <h5 class="pattern-title">üå∏ 6-6 Breathing Pattern</h5>
                                <p class="pattern-description mb-0">6s inhale, 6s exhale | Perfect for relaxation</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <div class="pattern-selector-card"
                         data-pattern-id="77"
                         data-audio-url="Coherent_Piano_7_7_fermibot.mp3"
                         onclick="selectPattern(this)">
                        <div class="pattern-selector-content">
                            <div class="pattern-radio">
                                <span class="radio-indicator"></span>
                            </div>
                            <div class="pattern-info">
                                <h5 class="pattern-title">üåø 7-7 Breathing Pattern</h5>
                                <p class="pattern-description mb-0">7s inhale, 7s exhale | For deep relaxation</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <div class="pattern-selector-card"
                         data-pattern-id="88"
                         data-audio-url="Coherent_Piano_8_8_fermibot.mp3"
                         onclick="selectPattern(this)">
                        <div class="pattern-selector-content">
                            <div class="pattern-radio">
                                <span class="radio-indicator"></span>
                            </div>
                            <div class="pattern-info">
                                <h5 class="pattern-title">üåä 8-8 Breathing Pattern</h5>
                                <p class="pattern-description mb-0">8s inhale, 8s exhale | For meditation & calm</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-3">
                <p class="text-muted" style="font-size: 0.9rem;">
                    <strong>Note:</strong> Using Web Audio API for seamless looping without gaps between cycles.
                    Select a pattern above, then use the unified controls to play.
                </p>
            </div>
        </div>

        <!-- Practitioner Tips -->
        <div class="card mt-4 tips-card">
            <div class="card-body">
                <div class="tips-header-row">
                    <h5 class="card-title practitioner-color collapsible-header collapsed"
                        onclick="toggleCollapse('practitionerTips', this)">
                        üí° Practitioner Tips
                        <span class="collapse-icon">‚ñ∂</span>
                    </h5>
                    <div class="tips-navigation-inline">
                        <button class="btn beginner-btn btn-sm" onclick="scrollToSection('beginnerSection')">
                            ü°Ö Beginner
                        </button>
                        <button class="btn practitioner-btn btn-sm" onclick="scrollToSection('expertSection')">
                            ü°á Expert
                        </button>
                    </div>
                </div>
                <div class="collapsible-content collapsed" id="practitionerTips">
                    <ul>
                        <li>‚úÖ Start with the 5.5-5.5 pattern for best heart rate variability results</li>
                        <li>‚úÖ Practice for 10-20 minutes daily for noticeable benefits</li>
                        <li>‚úÖ Breathe through your nose with your belly expanding</li>
                        <li>‚úÖ Keep your eyes closed and focus on the piano tones</li>
                        <li>‚úÖ Gradually increase duration as you become more comfortable</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Section 3: Expert -->
    <div id="expertSection" class="level-section">
        <div class="section-header expert-header">
            <h2 class="section-title expert-color center-flex">üéõÔ∏è Expert Level | Custom Pattern Creator</h2>
            <p class="section-description">Create your own breathing patterns with customizable inhale, exhale, and pause durations.
                Perfect for advanced practitioners who want to explore different breathing techniques.</p>
        </div>

        <div class="programmable-section" id="programmableSection">

            <!-- Single unified card for all Expert controls -->
            <div class="programmable-card">
                <h5 class="expert-color text-center mb-3">‚öôÔ∏è Pattern Configuration</h5>

                <!-- Duration selectors - 1x4 horizontal -->
                <div class="row mb-3">
                    <div class="col-3">
                        <label class="duration-label">Inhale</label>
                        <select class="form-select" id="inDuration">
                            <option value="3">3s</option>
                            <option value="4">4s</option>
                            <option value="5">5s</option>
                            <option value="5.5" selected>5.5s</option>
                            <option value="6">6s</option>
                            <option value="7">7s</option>
                            <option value="8">8s</option>
                            <option value="9">9s</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label class="duration-label">Pause 1</label>
                        <select class="form-select" id="pause1Duration">
                            <option value="0" selected>0s</option>
                            <option value="1">1s</option>
                            <option value="2">2s</option>
                            <option value="3">3s</option>
                            <option value="4">4s</option>
                            <option value="5">5s</option>
                            <option value="6">6s</option>
                            <option value="7">7s</option>
                            <option value="8">8s</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label class="duration-label">Exhale</label>
                        <select class="form-select" id="outDuration">
                            <option value="3">3s</option>
                            <option value="4">4s</option>
                            <option value="5">5s</option>
                            <option value="5.5" selected>5.5s</option>
                            <option value="6">6s</option>
                            <option value="7">7s</option>
                            <option value="8">8s</option>
                            <option value="9">9s</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label class="duration-label">Pause 2</label>
                        <select class="form-select" id="pause2Duration">
                            <option value="0" selected>0s</option>
                            <option value="1">1s</option>
                            <option value="2">2s</option>
                            <option value="3">3s</option>
                            <option value="4">4s</option>
                            <option value="5">5s</option>
                            <option value="6">6s</option>
                            <option value="7">7s</option>
                            <option value="8">8s</option>
                        </select>
                    </div>
                </div>

                <!-- Timer and Visualizer Row -->
                <div class="row align-items-center mb-3">
                    <div class="col-6 text-center">
                        <!-- Timer with integrated mode toggle -->
                        <div class="custom-timer-inline justify-content-center">
                            <div class="timer-mode-toggle" title="Switch between timed (countdown) and infinite (count up) modes">
                                <button class="timer-mode-btn active" id="expertTimedModeBtn" onclick="setExpertTimerMode('timed')" title="Timed mode: Set a duration and timer counts down">
                                    ‚è±Ô∏è Timed
                                </button>
                                <button class="timer-mode-btn" id="expertInfiniteModeBtn" onclick="setExpertTimerMode('infinite')" title="Infinite mode: Timer counts up indefinitely">
                                    ‚àû Infinite
                                </button>
                            </div>
                            <input type="text"
                                   class="custom-timer editable"
                                   id="customPatternTimer"
                                   value="00:05:00"
                                   title="Custom Pattern Timer - Click to edit duration (HH:MM:SS)"
                                   pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}"
                                   maxlength="8"
                                   onchange="onExpertTimerInputChange(this.value)"
                                   onkeydown="onExpertTimerKeyDown(event, this)">
                        </div>
                        <div style="font-size: 0.7rem; color: #9e9e9e; margin-top: 2px;">
                            ‚è±Ô∏è Timer resets when you stop.
                        </div>
                    </div>

                    <div class="col-6">
                        <!-- Breath cycle visualizer -->
                        <div class="breath-visualizer" id="breathVisualizer">
                            <!-- Phases will be dynamically inserted here -->
                        </div>
                        <!-- Current phase indicator -->
                        <div style="font-size: 0.7rem; color: #9e9e9e; margin-top: 2px; text-align: center;">
                            <span class="current-phase-indicator" id="currentPhase">Ready to start</span>
                        </div>
                    </div>
                </div>

                <!-- Play/Pause/Stop Buttons -->
                <div class="d-flex flex-column align-items-center">
                    <div class="unified-buttons">
                        <button class="btn btn-primary btn-lg unified-play" id="programmablePlay" disabled>
                            ‚ñ∂Ô∏è Play
                        </button>
                        <button class="btn btn-secondary btn-lg unified-pause" id="programmablePause" disabled>
                            ‚è∏Ô∏è Pause
                        </button>
                        <button class="btn btn-outline-secondary btn-lg unified-stop" id="programmableStop" disabled>
                            ‚èπÔ∏è Stop
                        </button>
                    </div>
                    <div class="audio-status text-center mt-2">
                        <span id="programmableLoading" class="audio-loading">Loading custom audio files...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expert Tips Card (New section, similar to practitioner tips) -->
        <div class="card mt-4 tips-card">
            <div class="card-body">
                <div class="tips-header-row">
                    <h5 class="card-title expert-color collapsible-header collapsed" onclick="toggleCollapse('expertTips', this)">
                        üí° Expert Tips
                        <span class="collapse-icon">‚ñ∂</span>
                    </h5>
                    <div class="tips-navigation-inline">
                        <button class="btn beginner-btn btn-sm" onclick="scrollToSection('beginnerSection')">
                            ü°Ö Beginner
                        </button>
                        <button class="btn practitioner-btn btn-sm" onclick="scrollToSection('practitionerSection')">
                            ü°Ö Practitioner
                        </button>
                    </div>
                </div>
                <div class="collapsible-content collapsed" id="expertTips">
                    <ul>
                        <li>‚úÖ Longer exhales (compared to inhales) promote relaxation</li>
                        <li>‚úÖ Add pauses to increase mindfulness and breath awareness</li>
                        <li>‚úÖ Experiment with 4-7-8 pattern (inhale 4s, hold 7s, exhale 8s)</li>
                        <li>‚úÖ Try box breathing (4-4-4-4 pattern) for focus and stress reduction</li>
                        <li>‚úÖ Save successful patterns in a journal for future reference</li>
                        <li>‚úÖ Adjust patterns based on your energy levels and time of day</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h5 class="expert-color text-center">üìä Expert Pattern Ideas</h5>
                <p class="text-center text-muted small mb-3">Click any pattern to apply it to the custom pattern creator
                    above</p>

                <!-- Pattern Ideas Grid - 3 per row -->
                <div class="row">
                    <!-- Row 1 -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="4" data-pause1="0" data-out="8" data-pause2="0"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üåä Calming 1:2 / Deep Sleep <sup><a href="#ref-calming"
                                                                                      class="footnote-link">[1]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 4s<br>Exhale: 8s<br>2:1 Ratio</p>
                                <div class="text-muted small">A long, gentle exhale biases the parasympathetic ‚Äúrest‚Äëand‚Äëdigest‚Äù response and often feels calming within a few cycles. Use it for winding down, reducing pre‚Äësleep mental chatter, or easing anxious arousal. Keep the inhale soft (no gulping) and let the exhale be smooth and unforced. If you feel air hunger, shorten the exhale slightly and build up over time.</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="4" data-pause1="4" data-out="4" data-pause2="4"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üì¶ Box Breathing <sup><a href="#ref-box"
                                                                                            class="footnote-link">[2]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 4s<br>Hold: 4s<br>Exhale: 4s<br>Hold:
                                    4s</p>
                                <div class="text-muted small">A structured ‚Äúsquare‚Äù breath that pairs steady timing with brief breath holds. The predictability can reduce cognitive noise and support composure under pressure. Treat the holds as relaxed pauses (no straining). Helpful before presentations, during acute stress, or anytime you want a quick reset and improved attentional control. If you‚Äôre new to holds, start with shorter holds (e.g., 2s) and work up.</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="4" data-pause1="4" data-out="6" data-pause2="2"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üî∑ Rectangular <sup><a href="#ref-rect"
                                                                                          class="footnote-link">[3]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 4s<br>Hold: 4s<br>Exhale: 6s<br>Hold:
                                    2s</p>
                                <div class="text-muted small">A ‚Äúrectangle‚Äù breath that keeps the inhale steady, extends the exhale, and adds a short recovery pause. The longer exhale can feel more settling, while the brief post‚Äëexhale pause helps you notice the transition into calm. Use for downshifting after work, easing mild anxiety, or re‚Äëcentering between tasks. Keep shoulders relaxed and breathe low into the belly.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 2 -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="4" data-pause1="4" data-out="8" data-pause2="0"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üßò 4-4-8 Pattern <sup><a href="#ref-448"
                                                                                            class="footnote-link">[4]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 4s<br>Hold: 4s<br>Exhale: 8s</p>
                                <div class="text-muted small">This pattern combines a short comfortable inhale, a brief hold, and an extended exhale. The hold encourages a moment of stillness and awareness; the long exhale is often experienced as ‚Äúletting go.‚Äù Use it as a relaxation drill, a bridge into meditation, or a tool to reduce physiological arousal. If dizziness occurs, reduce the hold first, then shorten the exhale.</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="4" data-pause1="7" data-out="8" data-pause2="0"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üò¥ 4-7-8 Sleep <sup><a href="#ref-478"
                                                                                          class="footnote-link">[5]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 4s<br>Hold: 7s<br>Exhale: 8s</p>
                                <div class="text-muted small">A classic sleep‚Äëleaning breath that emphasizes a longer hold and a long exhale. Many people use it to slow racing thoughts and encourage drowsiness. The hold should feel calm‚Äînot tense‚Äîso adjust it if it‚Äôs too demanding. Do a few rounds (e.g., 4 cycles), then return to natural breathing. Avoid forcing the exhale; aim for smooth, quiet airflow.</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="5.5" data-pause1="0" data-out="5.5" data-pause2="0"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">‚ù§Ô∏è Heart Coherence <sup><a href="#ref-coherence"
                                                                                               class="footnote-link">[6]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 5.5s<br>Exhale: 5.5s<br>Optimal HRV</p>
                                <div class="text-muted small">A balanced slow rhythm near ~5‚Äì6 breaths/min, commonly used in HRV training. The goal is steady, comfortable nasal breathing that feels almost ‚Äúmetronomic.‚Äù Many people report improved calm focus and emotional steadiness with consistent daily practice. Keep the breath light and continuous (no pauses), and prioritize consistency over intensity. If 5.5s feels too long, start at 5/5 and gradually lengthen.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 3 -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="3" data-pause1="0" data-out="8" data-pause2="0"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üå¨Ô∏è Physiological Sigh <sup><a href="#ref-sigh"
                                                                                                  class="footnote-link">[7]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 3s<br>Exhale: 8s<br>Immediate Reset</p>
                                <div class="text-muted small">A rapid downshift pattern inspired by research on ‚Äúcyclic sighing‚Äù: a relatively short inhale paired with a long exhale to quickly reduce stress. Use it when you feel keyed up, after a startling moment, or as a quick emotional reset. Keep the inhale gentle (not a sharp gasp) and make the exhale the focus. After a few cycles, transition to slower, even breathing.</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <div class="card h-100 pattern-idea-card"
                             data-in="4" data-pause1="4" data-out="4" data-pause2="0"
                             onclick="applyPatternIdea(this)">
                            <div class="card-body text-center">
                                <h6 class="card-title expert-color">üî∫ Triangle Breathing <sup><a href="#ref-triangle"
                                                                                                  class="footnote-link">[8]</a></sup>
                                </h6>
                                <p class="card-text pattern-description">Inhale: 4s<br>Hold: 4s<br>Exhale: 4s</p>
                                <div class="text-muted small">A simple, even-count breath that can feel stabilizing and grounding. The equal inhale/hold/exhale rhythm supports steady attention and can be useful when you want calm without becoming sleepy. Keep the hold relaxed (no throat tension). If 4 seconds feels too long, try 3-3-3 first and build up gradually.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- References Button (replaces inline references section) -->
                <div class="text-center mt-4 pt-3 border-top">
                    <button type="button" class="btn btn-outline-secondary btn-lg" data-bs-toggle="modal" data-bs-target="#referencesModal">
                        üìö View Scientific References
                    </button>
                    <p class="text-muted small mt-2">Click to view research citations for all breathing patterns</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- References Modal -->
<div class="modal fade" id="referencesModal" tabindex="-1" aria-labelledby="referencesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="referencesModalLabel">üìö Scientific References</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Research citations and scientific sources for all breathing patterns featured on this page.</p>
                <ol class="references-list">
                    <li id="ref-calming">
                        <strong class="reference-pattern-name">Calming 1:2 / Deep Sleep (4-8):</strong>
                        <ul class="reference-links">
                            <li><a href="https://pubmed.ncbi.nlm.nih.gov/25156003/" target="_blank" rel="noopener">Applied Psychophysiol Biofeedback - I/E Ratio Study (Van Diest 2014)</a></li>
                            <li><a href="https://pubmed.ncbi.nlm.nih.gov/24020097/" target="_blank" rel="noopener">PubMed - 2:1 Yogic Breathing & Hypertension</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC6037091/" target="_blank" rel="noopener">PMC - Relaxation Effect of Prolonged Expiratory Breathing</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10395759/" target="_blank" rel="noopener">PMC - Slow Breathing & Extended Exhale</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC7724962/" target="_blank" rel="noopener">PMC - DBRT for Sleep Quality</a></li>
                            <li><a href="https://www.nature.com/articles/s41598-021-98736-9" target="_blank" rel="noopener">Scientific Reports - Deep Slow Breathing & Vagal Tone</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9873947/" target="_blank" rel="noopener">Cell Reports Medicine - Exhale-Emphasized Breathing (Balban et al. 2023)</a></li>
                        </ul>
                    </li>
                    <li id="ref-box">
                        <strong class="reference-pattern-name">Box Breathing:</strong>
                        <ul class="reference-links">
                            <li><a href="https://health.clevelandclinic.org/box-breathing-benefits" target="_blank" rel="noopener">Cleveland Clinic - Box Breathing Benefits</a></li>
                            <li><a href="https://www.health.harvard.edu/mind-and-mood/try-this-take-a-tactical-breather" target="_blank" rel="noopener">Harvard Health - Tactical Breathing</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9873947/" target="_blank" rel="noopener">Cell Reports Medicine - Balban et al. 2023</a></li>
                        </ul>
                    </li>
                    <li id="ref-rect">
                        <strong class="reference-pattern-name">Rectangular Breathing:</strong>
                        <ul class="reference-links">
                            <li><a href="https://www.siumed.edu/gme/breath-wellness" target="_blank" rel="noopener">SIU School of Medicine - Breath & Wellness</a></li>
                            <li><a href="https://www.imasterhealth.com/blog/the-4-4-6-2-breathing-technique" target="_blank" rel="noopener">iMaster Health - 4-4-6-2 Breathing Technique</a></li>
                        </ul>
                    </li>
                    <li id="ref-448">
                        <strong class="reference-pattern-name">4-4-8 Breathing:</strong>
                        <ul class="reference-links">
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC11229811/" target="_blank" rel="noopener">PMC/NIH - Breathing Pattern Research</a></li>
                        </ul>
                    </li>
                    <li id="ref-478">
                        <strong class="reference-pattern-name">4-7-8 Breathing:</strong>
                        <ul class="reference-links">
                            <li><a href="https://www.drweil.com/videos-features/videos/breathing-exercises-4-7-8-breath/" target="_blank" rel="noopener">Dr. Andrew Weil - 4-7-8 Breath</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9277512/" target="_blank" rel="noopener">PMC - HRV & Blood Pressure Study</a></li>
                            <li><a href="https://www.researchgate.net/publication/394625657" target="_blank" rel="noopener">ResearchGate - Scoping Review 2024</a></li>
                        </ul>
                    </li>
                    <li id="ref-coherence">
                        <strong class="reference-pattern-name">Heart Coherence (5.5-5.5):</strong>
                        <ul class="reference-links">
                            <li><a href="https://pubmed.ncbi.nlm.nih.gov/24380741/" target="_blank" rel="noopener">PubMed - Heart Rate Variability Research</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5575449/" target="_blank" rel="noopener">Frontiers - Resonance Frequency Impact</a></li>
                            <li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC6137615/" target="_blank" rel="noopener">PMC - Slow/Deep Breathing review (autonomic mechanisms)</a></li>
                            <li><a href="https://link.springer.com/article/10.1023/A:1022312815649" target="_blank" rel="noopener">Springer - Applied Psychophysiology & Biofeedback article</a></li>
                            <li><a href="https://publications.ersnet.org/content/breathe/13/4/298" target="_blank" rel="noopener">ERS Breathe - Breathing exercises review</a></li>
                        </ul>
                    </li>
                    <li id="ref-sigh">
                        <strong class="reference-pattern-name">Physiological Sigh:</strong>
                        <ul class="reference-links">
                            <li><a href="https://doi.org/10.1016/j.xcrm.2022.100895" target="_blank" rel="noopener">Cell Reports Medicine - Balban et al. 2023</a></li>
                            <li><a href="https://med.stanford.edu/news/insights/2023/02/cyclic-sighing-can-help-breathe-away-anxiety.html" target="_blank" rel="noopener">Stanford Medicine - Cyclic Sighing</a></li>
                        </ul>
                    </li>
                    <li id="ref-triangle">
                        <strong class="reference-pattern-name">Triangle Breathing:</strong>
                        <ul class="reference-links">
                            <li><a href="https://cabincreekhealth.com/guided-relaxation-triangle-5-5-5-breathing/" target="_blank" rel="noopener">Cabin Creek Health - Guided Relaxation Triangle (5-5-5)</a></li>
                            <li><a href="https://yogajala.com/triangle-breathing/" target="_blank" rel="noopener">YogaJala - Triangle Breathing</a></li>
                            <li><a href="https://www.clayfulhealth.com/blog/using-the-triangle-breathing-tool-to-teach-self-regulation" target="_blank" rel="noopener">Clayful - Triangle Breathing for Self-Regulation</a></li>
                        </ul>
                    </li>
                </ol>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="footer_placeholder"></div>

<script>
    loadHeaderFooter("../../../automation/header.html", "../../../automation/footer.html", "../../../automation/theme_toggle.html")

    // Timer mode management
    function setTimerMode(mode) {
        const infiniteBtn = document.getElementById('infiniteModeBtn');
        const timedBtn = document.getElementById('timedModeBtn');
        const timerInput = document.getElementById('sessionTimer');

        // Update button states
        if (mode === 'infinite') {
            infiniteBtn.classList.add('active');
            timedBtn.classList.remove('active');
            timerInput.readOnly = true;
            timerInput.classList.remove('editable');
            timerInput.value = '00:00:00';
        } else {
            infiniteBtn.classList.remove('active');
            timedBtn.classList.add('active');
            timerInput.readOnly = false;
            timerInput.classList.add('editable');
            timerInput.value = '00:05:00'; // Default 5 minutes

            // Focus the input and place cursor at the end
            timerInput.focus();
            timerInput.setSelectionRange(8, 8);
        }

        // Update the session timer if it exists
        if (window.audioPlayers && window.audioPlayers.sessionTimer) {
            window.audioPlayers.sessionTimer.setMode(mode);

            // If switching to timed mode, set the duration and callback
            if (mode === 'timed') {
                const seconds = parseTimerInput(timerInput.value);
                window.audioPlayers.sessionTimer.setTargetDuration(seconds);
                window.audioPlayers.sessionTimer.setOnTimerComplete(() => {
                    if (window.audioPlayers.unifiedPlayer && window.audioPlayers.unifiedPlayer.isPlaying) {
                        window.audioPlayers.unifiedPlayer.stop();
                    }
                });
            } else {
                window.audioPlayers.sessionTimer.setOnTimerComplete(null);
            }
        }
    }

    function parseTimerInput(value) {
        // Parse HH:MM:SS format to seconds
        const parts = value.split(':');
        if (parts.length === 3) {
            const hours = parseInt(parts[0]) || 0;
            const minutes = parseInt(parts[1]) || 0;
            const seconds = parseInt(parts[2]) || 0;
            return hours * 3600 + minutes * 60 + seconds;
        }
        return 300; // Default 5 minutes
    }

    function onTimerInputChange(value) {
        // Validate and format the input
        let formatted = value.replace(/[^0-9:]/g, '');

        // Try to parse and reformat
        const seconds = parseTimerInput(formatted);

        // Update the session timer duration
        if (window.audioPlayers && window.audioPlayers.sessionTimer) {
            window.audioPlayers.sessionTimer.setTargetDuration(seconds);
        }
    }

    // Handle keydown for timer input - calculator-style entry (right to left)
    function onTimerKeyDown(event, input) {
        const key = event.key;
        const value = input.value;

        // If readonly, don't handle
        if (input.readOnly) return;

        // Handle backspace - shift all digits right, insert 0 at left
        if (key === 'Backspace') {
            event.preventDefault();

            // Get only digits
            let digits = value.replace(/:/g, '');

            // Shift right (remove last digit, add 0 at start)
            digits = '0' + digits.substring(0, digits.length - 1);

            // Reformat as HH:MM:SS
            const newValue = digits.substring(0, 2) + ':' + digits.substring(2, 4) + ':' + digits.substring(4, 6);
            input.value = newValue;

            // Keep cursor at end
            input.setSelectionRange(8, 8);
            onTimerInputChange(newValue);
            return;
        }

        // Handle number input - shift all digits left, add new digit at right
        if (/^[0-9]$/.test(key)) {
            event.preventDefault();

            // Get only digits
            let digits = value.replace(/:/g, '');

            // Shift left (remove first digit, add new digit at end)
            digits = digits.substring(1) + key;

            // Reformat as HH:MM:SS
            const newValue = digits.substring(0, 2) + ':' + digits.substring(2, 4) + ':' + digits.substring(4, 6);
            input.value = newValue;

            // Keep cursor at end
            input.setSelectionRange(8, 8);
            onTimerInputChange(newValue);
            return;
        }

        // Handle Enter key - start the timer
        if (key === 'Enter') {
            event.preventDefault();
            input.blur(); // Remove focus from input

            // Click the play button to start
            const playBtn = document.getElementById('unifiedPlay');
            if (playBtn && !playBtn.disabled) {
                playBtn.click();
            }
            return;
        }

        // Allow navigation keys
        if (['ArrowLeft', 'ArrowRight', 'Tab', 'Home', 'End'].includes(key)) {
            return;
        }

        // Block all other keys (including Delete)
        event.preventDefault();
    }

    function setSessionDuration(seconds) {
        if (window.audioPlayers && window.audioPlayers.sessionTimer) {
            window.audioPlayers.sessionTimer.setTargetDuration(parseInt(seconds));
        }
    }

    // Expert Timer Mode Management
    function setExpertTimerMode(mode) {
        const infiniteBtn = document.getElementById('expertInfiniteModeBtn');
        const timedBtn = document.getElementById('expertTimedModeBtn');
        const timerInput = document.getElementById('customPatternTimer');

        // Update button states
        if (mode === 'infinite') {
            infiniteBtn.classList.add('active');
            timedBtn.classList.remove('active');
            timerInput.readOnly = true;
            timerInput.classList.remove('editable');
            timerInput.value = '00:00:00';
        } else {
            infiniteBtn.classList.remove('active');
            timedBtn.classList.add('active');
            timerInput.readOnly = false;
            timerInput.classList.add('editable');
            timerInput.value = '00:05:00'; // Default 5 minutes

            // Focus the input and place cursor at the end
            timerInput.focus();
            timerInput.setSelectionRange(8, 8);
        }

        // Update the programmable sequencer timer if it exists
        if (window.audioPlayers && window.audioPlayers.programmableSequencer) {
            const sequencer = window.audioPlayers.programmableSequencer;
            if (sequencer.customTimer) {
                sequencer.customTimer.setMode(mode);

                if (mode === 'timed') {
                    const seconds = parseTimerInput(timerInput.value);
                    sequencer.customTimer.setTargetDuration(seconds);
                    sequencer.customTimer.setOnTimerComplete(() => {
                        sequencer.stop();
                    });
                } else {
                    sequencer.customTimer.setOnTimerComplete(null);
                }
            }
        }
    }

    function onExpertTimerInputChange(value) {
        // Validate and format the input
        let formatted = value.replace(/[^0-9:]/g, '');
        const seconds = parseTimerInput(formatted);

        // Update the programmable sequencer timer duration
        if (window.audioPlayers && window.audioPlayers.programmableSequencer) {
            const sequencer = window.audioPlayers.programmableSequencer;
            if (sequencer.customTimer) {
                sequencer.customTimer.setTargetDuration(seconds);
            }
        }
    }

    // Handle keydown for expert timer input - calculator-style entry (right to left)
    function onExpertTimerKeyDown(event, input) {
        const key = event.key;
        const value = input.value;

        // If readonly, don't handle
        if (input.readOnly) return;

        // Handle backspace - shift all digits right, insert 0 at left
        if (key === 'Backspace') {
            event.preventDefault();
            let digits = value.replace(/:/g, '');
            digits = '0' + digits.substring(0, digits.length - 1);
            const newValue = digits.substring(0, 2) + ':' + digits.substring(2, 4) + ':' + digits.substring(4, 6);
            input.value = newValue;
            input.setSelectionRange(8, 8);
            onExpertTimerInputChange(newValue);
            return;
        }

        // Handle number input - shift all digits left, add new digit at right
        if (/^[0-9]$/.test(key)) {
            event.preventDefault();
            let digits = value.replace(/:/g, '');
            digits = digits.substring(1) + key;
            const newValue = digits.substring(0, 2) + ':' + digits.substring(2, 4) + ':' + digits.substring(4, 6);
            input.value = newValue;
            input.setSelectionRange(8, 8);
            onExpertTimerInputChange(newValue);
            return;
        }

        // Handle Enter key - start the custom pattern
        if (key === 'Enter') {
            event.preventDefault();
            input.blur();

            // Start the programmable sequencer
            if (window.audioPlayers && window.audioPlayers.programmableSequencer) {
                window.audioPlayers.programmableSequencer.play();
            }
            return;
        }

        // Allow navigation keys
        if (['ArrowLeft', 'ArrowRight', 'Tab', 'Home', 'End'].includes(key)) {
            return;
        }

        // Block all other keys
        event.preventDefault();
    }

    // Smooth scrolling function
    function scrollToSection(sectionId) {
        document.getElementById(sectionId).scrollIntoView({
            behavior: 'smooth'
        });

        // Highlight the clicked level card
        document.querySelectorAll('.level-card').forEach(card => {
            card.classList.remove('active-level');
        });
        document.getElementById(sectionId + 'Card').classList.add('active-level');
    }

    // Toggle collapsible sections
    function toggleCollapse(contentId, headerElement) {
        const content = document.getElementById(contentId);
        const icon = headerElement.querySelector('.collapse-icon');

        content.classList.toggle('collapsed');
        headerElement.classList.toggle('collapsed');

        if (content.classList.contains('collapsed')) {
            icon.textContent = '‚ñ∂';
        } else {
            icon.textContent = '‚ñº';
        }
    }

    // Apply pattern idea to custom pattern creator
    function applyPatternIdea(card) {
        // Get pattern values from data attributes
        const inDuration = card.dataset.in;
        const pause1Duration = card.dataset.pause1;
        const outDuration = card.dataset.out;
        const pause2Duration = card.dataset.pause2;

        // Set the select element values
        document.getElementById('inDuration').value = inDuration;
        document.getElementById('pause1Duration').value = pause1Duration;
        document.getElementById('outDuration').value = outDuration;
        document.getElementById('pause2Duration').value = pause2Duration;

        // Clear all pattern card highlights
        document.querySelectorAll('.pattern-idea-card').forEach(c => {
            c.classList.remove('pattern-idea-selected');
        });

        // Clear any stale reference highlights (references are no longer highlighted)
        document.querySelectorAll('.reference-pattern-name').forEach(r => {
            r.classList.remove('reference-pattern-selected');
        });

        // Highlight only the clicked pattern card
        card.classList.add('pattern-idea-selected');

        // Trigger the update in the programmable sequencer
        if (window.audioPlayers && window.audioPlayers.programmableSequencer) {
            window.audioPlayers.programmableSequencer.updateSettings();
        }

        // Scroll to the pattern configuration section
        document.getElementById('programmableSection').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });

        // Show a brief visual feedback
        const patternName = card.querySelector('.card-title').textContent;
        showPatternAppliedFeedback(patternName);
    }

    // Apply pattern from reference section
    function applyPatternFromReference(element) {
        // Get pattern values from data attributes
        const inDuration = element.dataset.in;
        const pause1Duration = element.dataset.pause1;
        const outDuration = element.dataset.out;
        const pause2Duration = element.dataset.pause2;

        // Set the select element values
        document.getElementById('inDuration').value = inDuration;
        document.getElementById('pause1Duration').value = pause1Duration;
        document.getElementById('outDuration').value = outDuration;
        document.getElementById('pause2Duration').value = pause2Duration;

        // Clear all pattern card highlights
        document.querySelectorAll('.pattern-idea-card').forEach(c => {
            c.classList.remove('pattern-idea-selected');
        });

        // Clear all reference highlights (no highlighting in references anymore)
        document.querySelectorAll('.reference-pattern-name').forEach(r => {
            r.classList.remove('reference-pattern-selected');
        });

        // Trigger the update in the programmable sequencer
        if (window.audioPlayers && window.audioPlayers.programmableSequencer) {
            window.audioPlayers.programmableSequencer.updateSettings();
        }

        // Show a brief visual feedback
        const patternName = element.textContent.replace(':', '');
        showPatternAppliedFeedback(patternName);

        // Scroll to the pattern configuration section
        document.getElementById('programmableSection').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }

    // Show feedback when pattern is applied
    function showPatternAppliedFeedback(patternName) {
        // Create or get feedback element
        let feedback = document.getElementById('patternAppliedFeedback');
        if (!feedback) {
            feedback = document.createElement('div');
            feedback.id = 'patternAppliedFeedback';
            feedback.className = 'pattern-applied-feedback';
            document.body.appendChild(feedback);
        }

        // Clean pattern name
        const cleanName = patternName.replace(/\s*\[\d+\]\s*/g, '').trim();
        feedback.textContent = `‚úì ${cleanName} applied!`;
        feedback.classList.add('show');

        // Hide after 2 seconds
        setTimeout(() => {
            feedback.classList.remove('show');
        }, 2000);
    }
</script>

<!-- Bootstrap JavaScript Bundle (required for modal functionality) -->
<script src="../../../bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Main JavaScript files -->
<script src="coherent_breathing_audio.js"></script>
<script src="coherent_breathing_programmable.js"></script>
<script src="coherent_breathing_main.js"></script>

<!-- Script to handle footnote clicks -->
<script>
    // Handle footnote link clicks - open modal and scroll to reference
    document.addEventListener('DOMContentLoaded', function() {
        const footnoteLinks = document.querySelectorAll('.footnote-link');
        const referencesModal = new bootstrap.Modal(document.getElementById('referencesModal'));

        footnoteLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();

                // Get the reference ID from href
                const refId = this.getAttribute('href').substring(1);

                // Open the modal
                referencesModal.show();

                // Wait for modal to open, then scroll to the reference
                setTimeout(() => {
                    const refElement = document.getElementById(refId);
                    if (refElement) {
                        refElement.scrollIntoView({ behavior: 'smooth', block: 'center' });

                        // Temporarily highlight the reference
                        refElement.style.backgroundColor = 'rgba(55, 71, 79, 0.15)';
                        refElement.style.transition = 'background-color 0.3s ease';

                        setTimeout(() => {
                            refElement.style.backgroundColor = '';
                        }, 2000);
                    }
                }, 300);
            });
        });
    });
</script>

</body>
</html>



